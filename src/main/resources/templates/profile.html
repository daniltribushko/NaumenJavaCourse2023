<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Профиль</title>
</head>
<body>
    <div>
        <h2>Личный кабинет:</h2>
        <br>
        <p th:text="${user.getFirstname() + ' ' + user.getLastname()}"></p>
        <p th:text="${user.email}"></p>
        <p>________________________________________________________</p>
    </div>
    <div th:if="${user.getTeam() != null}">
        <h3>Ваша команда: </h3>
        <p th:text="${'Назавание команды: ' + user.getTeam().name}"></p>
        <p th:text="${'Описание команды: ' + user.getTeam().description}"></p>
        <p>Состав команды: </p>
        <div th:each="participant : ${user.getTeam().getParticipants()}">
            <p th:if="${participant.getTeamStatus() == 'leader'}" th:text="${participant.username + ' (лидер)'}"></p>
            <p th:if="${participant.getTeamStatus() != 'leader'}" th:text="${participant.username}"></p>
            <form th:method="POST" th:if="${user.getTeamStatus() == 'leader'} and ${participant.getTeamStatus() != 'leader'}"
                  th:action="@{/teams/leave{username}(username=${participant.getUsername()})}">
                <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                <input type="submit" value="Выгнать из команды"/>
            </form>
        </div>
        <form th:method="POST"  th:if="${user.getTeamStatus() == 'leader'}" th:action="@{/teams/delete}">
            <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
            <input  type="submit" value="Распустить команду"/>
        </form>
        <form th:method="POST" th:if="${user.getTeamStatus() != 'leader'}" th:action="@{/teams/leave}">
            <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
            <input  type="submit" value="Выйти из команды"/>
        </form>
        <div>
            <h2>Заявки на вступление:</h2>
            <div th:each="oneUser : ${user.getTeam().getRequests()}">
                <p th:text="${'ФИО: ' + oneUser.getLastname() + oneUser.getFirstname() + oneUser.getSurname()}"></p>
                <p th:text="${'Почта: ' + oneUser.getEmail()}"></p>
                <p th:text="${'Язык программирования: ' + oneUser.getProgrammingLanguage()}"></p>
                <form  th:method="POST" th:action="@{/teams/accept/{username}(username=${oneUser.getUsername()})}">
                    <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                    <input type="submit" value="Принять"/>
                </form>
                <form  th:method="DELETE" th:action="@{/teams/reject/{username}(username=${oneUser.getUsername()})}">
                    <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                    <input type="submit" value="Отклонить"/>
                </form>
                <p>_______________________________________</p>
            </div>
        </div>
    </div>

    <div th:if="${user.getTeam() == null}">
        <div>
            <h3>Создание команды:</h3>
            <form th:method="POST" th:action="@{/teams/create}" th:object="${team}">
                <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                <label for="name">Введите Название команды: </label>
                <input type="text" th:field="*{name}" id="name"/>
                <div style="color:red" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Name Error</div>
                <br/>
                <label for="description">Введите описание команды: </label>
                <input type="text" th:field="*{description}" id="description"/>
                <div style="color:red" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Description Error</div>

                <input type="submit" value="Создать"/>
            </form>
        </div>
        <h3>Вступить в команду: </h3>
        <div th:each="oneTeam : ${allTeams}">
            <form th:method="POST" th:action="@{/teams/sendRequest/{id}(id=${oneTeam.getIdTeam()})}" >
                <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                <p th:text="${'Название команды: ' + oneTeam.name}"></p>
                <p th:text="${'Описание команды: ' + oneTeam.description}"></p>
                <label for="programmingLanguage">Укажите ваш язык программирования: </label>
                <input type="text" id="programmingLanguage" name="programmingLanguage"/>
                <input type="submit" value="Подать заявку на вступление"/>
                <p>______________________________________________________</p>
            </form>

        </div>
        <h3>Отправленные запросы: </h3>
        <div th:each="oneTeam : ${user.getRequests()}">
            <form th:method="POST" th:action="@{/teams/cancel/{id}(id=${oneTeam.getIdTeam()})}">
                <input type="hidden" th:name="${_csrf.getParameterName()}" th:value="${_csrf.getToken()}">
                <p th:text="${'Название команды: ' + oneTeam.name}"></p>
                <p th:text="${'Описание команды: ' + oneTeam.description}"></p>
                <input th:color="red" type="submit" value="Отменить заявку на вступление"/>
                <p>______________________________________________________</p>
            </form>
        </div>
    </div>
    <style>
        select {
            display: block;
        }
    </style>
</body>
</html>